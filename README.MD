# Critical Section. Race Condition. Atomic Operations.

–¶–µ–π –ø—Ä–æ—î–∫—Ç —Ä–µ–∞–ª—ñ–∑—É—î –±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤—É –æ–±—Ä–æ–±–∫—É –≤ C++ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –º–µ—Ö–∞–Ω—ñ–∑–º—ñ–≤ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ –¥–ª—è:

- –ü–∞—Ä–∞–ª–µ–ª—å–Ω–æ–≥–æ –º–Ω–æ–∂–µ–Ω–Ω—è –º–∞—Ç—Ä–∏—Ü—å A[n√óm] —Ç–∞ B[m√ók]
- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó –¥–æ—Å—Ç—É–ø—É –¥–æ —Å–ø—ñ–ª—å–Ω–æ—ó –∑–º—ñ–Ω–Ω–æ—ó —ñ–∑ —Ç–∞ –±–µ–∑ –∑–∞—Ö–∏—Å—Ç—É –∫—Ä–∏—Ç–∏—á–Ω–æ—ó —Å–µ–∫—Ü—ñ—ó

## üîß –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ

### üß† 1. –ü–∞—Ä–∞–ª–µ–ª—å–Ω–µ –º–Ω–æ–∂–µ–Ω–Ω—è –º–∞—Ç—Ä–∏—Ü—å

- **`matrix_multiply.cpp`**: —Å—Ç–≤–æ—Ä—é—î `n√ók` –ø–æ—Ç–æ–∫—ñ–≤ (–∞–±–æ –º–µ–Ω—à–µ ‚Äî –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤), –∫–æ–∂–µ–Ω –∑ —è–∫–∏—Ö –æ–±—á–∏—Å–ª—é—î –µ–ª–µ–º–µ–Ω—Ç –º–∞—Ç—Ä–∏—Ü—ñ –¥–æ–±—É—Ç–∫—É.
- –ü—Ä–æ–º—ñ–∂–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –æ–¥—Ä–∞–∑—É –≤–∏–≤–æ–¥—è—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å —É —Ñ–æ—Ä–º–∞—Ç—ñ:
  ```
  [i,j] = value
  ```
- –ü—Ä–∏—Å—É—Ç–Ω—ñ–π –∑–∞–º—ñ—Ä —á–∞—Å—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–∏ —Ä—ñ–∑–Ω—ñ–π –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø–æ—Ç–æ–∫—ñ–≤, —â–æ –¥–æ–∑–≤–æ–ª—è—î:

### üîê 2. –†–æ–±–æ—Ç–∞ –∑ –∫—Ä–∏—Ç–∏—á–Ω–∏–º–∏ —Å–µ–∫—Ü—ñ—è–º–∏

- **`race_condition.cpp`**:

  - –ó–∞–ø—É—Å–∫–∞—î 2 –ø–æ—Ç–æ–∫–∏, —è–∫—ñ —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç—É—é—Ç—å —Å–ø—ñ–ª—å–Ω—É –∑–º—ñ–Ω–Ω—É `v` 1 –º—ñ–ª—å—è—Ä–¥ —Ä–∞–∑—ñ–≤.
  - –Ñ 2 —Ä–µ–∂–∏–º–∏:
    - –ë–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó (–æ—á—ñ–∫—É–≤–∞–Ω—ñ race conditions)
    - –ó –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º `std::mutex` —Ç–∞ `std::atomic` (–∫–æ—Ä–µ–∫—Ç–Ω–∞ –æ–±—Ä–æ–±–∫–∞)

- **`synchronized_add.cpp`**:
  - –†–µ–∞–ª—ñ–∑—É—î –ø–æ–≤–Ω—ñ—Å—Ç—é —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —É –¥–≤–æ—Ö –ø–æ—Ç–æ–∫–∞—Ö –∫—Ä–æ–∫-–≤-–∫—Ä–æ–∫ (–≤—ñ–¥ 0 –¥–æ 1000), –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –∑–Ω–∞—á–µ–Ω–Ω—è.
  - –î–ª—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è `std::condition_variable` —Ç–∞ `std::mutex`.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

```bash
os4/
‚îú‚îÄ‚îÄ Makefile                    # –§–∞–π–ª –¥–ª—è –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó –ø—Ä–æ–µ–∫—Ç—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Make
‚îú‚îÄ‚îÄ README.md                   # –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó —Ç–∞ –æ–ø–∏—Å –ø—Ä–æ–µ–∫—Ç—É
‚îú‚îÄ‚îÄ src/                        # –î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è –∑ –≤–∏—Ö—ñ–¥–Ω–∏–º –∫–æ–¥–æ–º
‚îÇ   ‚îú‚îÄ‚îÄ main.cpp                # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª, —Ç–æ—á–∫–∞ –≤—Ö–æ–¥—É –≤ –ø—Ä–æ–≥—Ä–∞–º—É
‚îÇ   ‚îú‚îÄ‚îÄ matrix_multiply.cpp     # –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–Ω–æ–∂–µ–Ω–Ω—è –º–∞—Ç—Ä–∏—Ü—å
‚îÇ   ‚îú‚îÄ‚îÄ matrix_multiply.hpp     # –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω–∏–π —Ñ–∞–π–ª –¥–ª—è matrix_multiply.cpp
‚îÇ   ‚îú‚îÄ‚îÄ race_condition.cpp      # –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑–∞–¥–∞—á—ñ –∑ race condition (–±–µ–∑ –∫—Ä–∏—Ç–∏—á–Ω–æ—ó —Å–µ–∫—Ü—ñ—ó)
‚îÇ   ‚îú‚îÄ‚îÄ race_condition.hpp      # –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω–∏–π —Ñ–∞–π–ª –¥–ª—è race_condition.cpp
‚îÇ   ‚îú‚îÄ‚îÄ synchronized_add.cpp    # –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑–∞–¥–∞—á—ñ –∑ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–∏–º –¥–æ–¥–∞–≤–∞–Ω–Ω—è–º
‚îÇ   ‚îî‚îÄ‚îÄ synchronized_add.hpp    # –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω–∏–π —Ñ–∞–π–ª –¥–ª—è synchronized_add.cpp
‚îî‚îÄ‚îÄ dist/                       # –î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è –¥–ª—è —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ (–∑ º—è–≤–∏—Ç—å—Å—è –ø—ñ—Å–ª—è –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó)

```

## ‚öôÔ∏è –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Make –Ω–∞ macOS

Make –∑–∞–∑–≤–∏—á–∞–π –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Ä–∞–∑–æ–º —ñ–∑ `Xcode Command Line Tools`. –©–æ–± –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –≤—ñ–Ω –¥–æ—Å—Ç—É–ø–Ω–∏–π:

```bash
xcode-select --install
```

–Ø–∫—â–æ `make` –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ:

```bash
brew install make
```

## üõ†Ô∏è –ö–æ–º–ø—ñ–ª—è—Ü—ñ—è

```bash
make
```

–¶–µ –∑–≥–µ–Ω–µ—Ä—É—î –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª —É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó `dist/`:

- `dist/main`

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫

```bash
./dist/main
```

## üì§ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü—Ä–æ–≥—Ä–∞–º–∞ –≤–∏–≤–æ–¥–∏—Ç—å –ø—Ä–æ–º—ñ–∂–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —ñ —Ü–∏–º –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –Ω–µ–ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å (–ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ—Å—Ç—å –≤–∏–∫–Ω–∞–Ω–Ω—è), –∞ —Ç–∞–∫–æ–∂ –≤–∏–º—ñ—Ä—è –∑–∞—Ç—Ä–∞—á–µ–Ω–∏–π —á–∞—Å, —â–æ –¥–æ–∑–≤–æ–ª—è—î –ø—Ä–æ–≤–æ–¥–∏—Ç–∏ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏.

## ü™™ License

–¶–µ–π –ø—Ä–æ—î–∫—Ç –ª—ñ—Ü–µ–Ω–∑–æ–≤–∞–Ω–æ –∑–∞ —É–º–æ–≤–∞–º–∏ MIT License.
